version: '3.1'

services:
  database:
    image: mongo:latest
    restart: always
    ports:
      - "27017:27017"
  app:
    build:
      context: .Docker/app
    restart: always
    volumes:
      - ./:/usr/src/app
    links:
      - database:database
    ports:
      - "3000:3000"
  web:
    image: nginx
    volumes:
      - .Docker/web.conf:/etc/nginx/conf.d/web.conf
    ports:
      - "80:80"
    environment:
      - NGINX_HOST=heligram.com
      - NGINX_PORT=80
    links:
      - app:app
    command: /bin/bash -c "envsubst &lt; /etc/nginx/conf.d/web.conf &gt; /etc/nginx/conf.d/default.conf &amp;&amp; exec nginx -g 'daemon off;'"
