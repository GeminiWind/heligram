dist: trusty
sudo: false
language: node_js
node_js: '8.10'
cache: yarn
before_install:
  - sudo apt-get install awscli -y
  - echo 'Writing AWS Credential to file ...'
  - mkdir -p ~/.aws
  - echo "
    [default]\n
    aws_access_key_id = ${AWS_ACCESS_KEY}\n
    aws_secret_access_key = ${AWS_SECRET_KEY}\n
    region = ${AWS_DEPLOYMENT_REGION}\n
    " > ~/.aws/credentials
  - curl -sLo /tmp/terraform.zip https://releases.hashicorp.com/terraform/0.12.3/terraform_0.12.3_linux_amd64.zip
  - unzip /tmp/terraform.zip -d /tmp
  - mv /tmp/terraform ~/bin
  - export PATH="~/bin:$PATH"
install:
- yarn
jobs:
  include:
    - stage: lint
      script: yarn lint
    - stage: unit test
      script: yarn test:unit
    - stage: deploy
      deploy:
      - provider: script
        skip_cleanup: true
        script:
          cd ./.terraform
          terraform init
          terraform apply -var 'public_key_name=$PUBLIC_KEY_NAME'
        on:
          all_branches: true
